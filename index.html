<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Treino de Kana</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; margin: 0; padding: 40px; background-color: #fdfdfd; }
    
    /* Layout principal */
    .main-container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      position: relative;
    }

    .content-area {
      flex: 1;
      max-width: 800px; /* Limita a largura da tabela */
    }

    table { margin: 0 auto; border-collapse: collapse; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    td, th {
      border: 1px solid #ddd;
      padding: 10px;
      font-size: 28px;
      text-align: center;
      min-width: 50px;
    }
    th { background-color: #f4f4f4; color: #333; }
    
    label { cursor: pointer; display: block; user-select: none; }
    label:hover { background-color: #f9f9f9; }

    .kana { font-size: 120px; margin: 20px; font-weight: bold; color: #333; }
    
    input { 
      font-size: 24px; 
      padding: 10px; 
      text-align: center; 
      border: 2px solid #ccc; 
      border-radius: 8px; 
      outline: none;
      width: 200px;
      transition: border-color 0.3s;
    }
    input:focus { border-color: #007bff; }

    #feedback { font-size: 20px; margin-top: 10px; height: 24px; font-weight: bold; }

    .page { display: none; width: 100%; }

    .menu {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      margin-top: 30px;
    }

    .menu button {
      width: 250px;
      font-size: 22px;
      padding: 15px 30px;
      cursor: pointer;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      transition: transform 0.1s, background-color 0.2s;
    }
    .menu button:hover { background-color: #0056b3; transform: scale(1.02); }
    .menu button:active { transform: scale(0.98); }

    .selection-controls { margin-bottom: 15px; }
    .selection-controls button {
      font-size: 14px;
      padding: 8px 12px;
      margin: 0 5px;
      cursor: pointer;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .selection-controls button:hover { background-color: #e0e0e0; }

    /* --- NOVO CSS: PAINEL DE ERROS --- */
    #stats-panel {
      width: 200px;
      background: #fff;
      border: 2px solid #ffcccc;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      display: none; /* Escondido por padr√£o */
      
      /* Fixar na direita em telas grandes */
      position: fixed;
      right: 40px;
      top: 150px;
    }

    .stats-title {
      color: #d32f2f;
      font-weight: bold;
      margin-bottom: 10px;
      text-transform: uppercase;
      font-size: 14px;
      letter-spacing: 1px;
    }

    .error-count-display {
      font-size: 48px;
      font-weight: bold;
      color: #d32f2f;
      line-height: 1;
      margin-bottom: 10px;
    }

    #error-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 5px;
      margin-top: 10px;
    }

    .error-badge {
      background-color: #ffebee;
      color: #c62828;
      border: 1px solid #ffcdd2;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 18px;
      font-weight: bold;
    }

    /* Responsividade para telas menores: Painel vai para baixo */
    @media (max-width: 1100px) {
      #stats-panel {
        position: static;
        width: 100%;
        max-width: 400px;
        margin: 20px auto;
      }
      .main-container {
        display: block;
      }
    }
  </style>
</head>
<body>

<div class="main-container">
  
  <div class="content-area">

    <div id="home" class="page" style="display:block;">
      <h1 style="color:#333;">Treinos de Japon√™s</h1>
      <div class="menu">
        <button onclick="showPage('hiragana')">Hiragana</button>
        <button onclick="showPage('katakana')">Katakana</button>
        <button onclick="showPage('numeros')">N√∫meros (1‚Äì10)</button>
        <button onclick="window.location.href='numeros.html'" style="background-color: #6c757d;">N√∫meros (1-100)</button>
        <button onclick="window.location.href='vocabulario.html'" style="background-color: #28a745;">Flashcards de Vocabul√°rio</button>
      </div>
    </div>

    <div id="hiragana" class="page">
      <h2>Selecione os Hiragana</h2>
      
      <div class="selection-controls">
        <button onclick="toggleAll('table-container', true)">Selecionar Todos</button>
        <button onclick="toggleAll('table-container', false)">Limpar Todos</button>
      </div>

      <div id="table-container"></div>
      <br> 
      <button id="start-hira" class="menu" style="width: 200px; padding: 10px; margin: 0 auto; display:block;">Iniciar treino</button>
      <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

      <div id="app-hira" style="display:none;">
        <div class="kana" id="kana-hira"></div>
        <input id="answer-hira" placeholder="romaniza√ß√£o..." autocomplete="off">
        <p id="feedback-hira"></p>
      </div>

      <br><br>
      <button onclick="goBack()" style="cursor:pointer; padding: 10px 20px;">Voltar</button>
    </div>

    <div id="katakana" class="page">
      <h2>Selecione os Katakana</h2>
      
      <div class="selection-controls">
        <button onclick="toggleAll('table-kata', true)">Selecionar Todos</button>
        <button onclick="toggleAll('table-kata', false)">Limpar Todos</button>
      </div>

      <div id="table-kata"></div>
      <br>
      <button id="start-kata" class="menu" style="width: 200px; padding: 10px; margin: 0 auto; display:block;">Iniciar treino</button>
      <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

      <div id="app-kata" style="display:none;">
        <div class="kana" id="kana-kata"></div>
        <input id="answer-kata" placeholder="romaniza√ß√£o..." autocomplete="off">
        <p id="feedback-kata"></p>
      </div>

      <br><br>
      <button onclick="goBack()" style="cursor:pointer; padding: 10px 20px;">Voltar</button>
    </div>

    <div id="numeros" class="page">
      <h2>Treino de N√∫meros (1‚Äì10)</h2>

      <button id="start-num" class="menu" style="width: 200px; padding: 10px; margin: 0 auto; display:block;">Iniciar treino</button>

      <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">

      <div id="app-num" style="display:none;">
        <div class="kana" id="kana-num"></div>
        <input id="answer-num" placeholder="romaniza√ß√£o..." autocomplete="off">
        <p id="feedback-num"></p>
      </div>

      <br><br>
      <button onclick="goBack()" style="cursor:pointer; padding: 10px 20px;">Voltar</button>
    </div>

  </div> <div id="stats-panel">
    <div class="stats-title">Erros na Sess√£o</div>
    <div id="error-count" class="error-count-display">0</div>
    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Letras erradas:</div>
    <div id="error-list"></div>
  </div>

</div> <script>
// --- Controle de p√°ginas ---
function showPage(id) {
  document.querySelectorAll(".page").forEach(p => p.style.display = "none");
  document.getElementById(id).style.display = "block";
  // Esconde o painel de stats ao navegar entre menus, ele s√≥ aparece ao iniciar treino
  document.getElementById("stats-panel").style.display = "none";
}

function goBack() {
  showPage('home');
  // Esconde apps ativos
  document.getElementById('app-hira').style.display = 'none';
  document.getElementById('app-kata').style.display = 'none';
  document.getElementById('app-num').style.display = 'none';
}

function toggleAll(containerId, state) {
  const container = document.getElementById(containerId);
  const checkboxes = container.querySelectorAll('input[type="checkbox"]');
  checkboxes.forEach(cb => cb.checked = state);
}


// --- L√ìGICA DE ESTAT√çSTICAS (NOVO) ---
let sessionErrors = 0;
let sessionWrongList = [];

function resetStats() {
  sessionErrors = 0;
  sessionWrongList = [];
  updateStatsUI();
  document.getElementById("stats-panel").style.display = "block"; // Mostra o painel
}

function registerError(char) {
  sessionErrors++;
  sessionWrongList.push(char);
  updateStatsUI();
}

function updateStatsUI() {
  document.getElementById("error-count").textContent = sessionErrors;
  
  const listEl = document.getElementById("error-list");
  listEl.innerHTML = ""; // Limpa
  sessionWrongList.forEach(char => {
    const badge = document.createElement("span");
    badge.className = "error-badge";
    badge.textContent = char;
    listEl.appendChild(badge);
  });
}


// ------------ DADOS E TABELAS -------------------

const VOGAIS = ["A","I","U","E","O"];

const HIRAGANA_TABLE = {
  "":  { "A":"„ÅÇ","I":"„ÅÑ","U":"„ÅÜ","E":"„Åà","O":"„Åä" },
  "K": { "A":"„Åã","I":"„Åç","U":"„Åè","E":"„Åë","O":"„Åì" },
  "S": { "A":"„Åï","I":"„Åó","U":"„Åô","E":"„Åõ","O":"„Åù" },
  "T": { "A":"„Åü","I":"„Å°","U":"„Å§","E":"„Å¶","O":"„Å®" },
  "N": { "A":"„Å™","I":"„Å´","U":"„Å¨","E":"„Å≠","O":"„ÅÆ" },
  "H": { "A":"„ÅØ","I":"„Å≤","U":"„Åµ","E":"„Å∏","O":"„Åª" },
  "M": { "A":"„Åæ","I":"„Åø","U":"„ÇÄ","E":"„ÇÅ","O":"„ÇÇ" },
  "Y": { "A":"„ÇÑ",       "U":"„ÇÜ",       "O":"„Çà" },
  "R": { "A":"„Çâ","I":"„Çä","U":"„Çã","E":"„Çå","O":"„Çç" },
  "W": { "A":"„Çè",                     "O":"„Çí" },
  "N (Final)": { "A":"„Çì" }
};

const KATAKANA_TABLE = {
  "":  { "A":"„Ç¢","I":"„Ç§","U":"„Ç¶","E":"„Ç®","O":"„Ç™" },
  "K": { "A":"„Ç´","I":"„Ç≠","U":"„ÇØ","E":"„Ç±","O":"„Ç≥" },
  "S": { "A":"„Çµ","I":"„Ç∑","U":"„Çπ","E":"„Çª","O":"„ÇΩ" },
  "T": { "A":"„Çø","I":"„ÉÅ","U":"„ÉÑ","E":"„ÉÜ","O":"„Éà" },
  "N": { "A":"„Éä","I":"„Éã","U":"„Éå","E":"„Éç","O":"„Éé" },
  "H": { "A":"„Éè","I":"„Éí","U":"„Éï","E":"„Éò","O":"„Éõ" },
  "M": { "A":"„Éû","I":"„Éü","U":"„É†","E":"„É°","O":"„É¢" },
  "Y": { "A":"„É§",       "U":"„É¶",       "O":"„É®" },
  "R": { "A":"„É©","I":"„É™","U":"„É´","E":"„É¨","O":"„É≠" },
  "W": { "A":"„ÉØ",                     "O":"„É≤" },
  "N (Final)": { "A":"„É≥" }
};

const ROMAJI_MAP = {};

// Preencher com hiragana
for (const cons in HIRAGANA_TABLE) {
  for (const vow in HIRAGANA_TABLE[cons]) {
    ROMAJI_MAP[HIRAGANA_TABLE[cons][vow]] = (cons + vow).toLowerCase().replace("(final)a", ""); 
  }
}
ROMAJI_MAP["„Çì"] = "n"; ROMAJI_MAP["„É≥"] = "n";
ROMAJI_MAP["„Åó"] = "shi"; ROMAJI_MAP["„Å°"] = "chi"; ROMAJI_MAP["„Å§"] = "tsu"; ROMAJI_MAP["„Åµ"] = "fu"; ROMAJI_MAP["„Çí"] = "wo";

// Preencher com katakana
for (const cons in KATAKANA_TABLE) {
  for (const vow in KATAKANA_TABLE[cons]) {
    if(KATAKANA_TABLE[cons][vow] !== "„É≥")
        ROMAJI_MAP[KATAKANA_TABLE[cons][vow]] = (cons + vow).toLowerCase();
  }
}
ROMAJI_MAP["„Ç∑"] = "shi"; ROMAJI_MAP["„ÉÅ"] = "chi"; ROMAJI_MAP["„ÉÑ"] = "tsu"; ROMAJI_MAP["„Éï"] = "fu"; ROMAJI_MAP["„É≤"] = "wo";

function shuffle(array) {
  for (let i = array.length -1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// Render Hiragana Table
const contHira = document.getElementById("table-container");
const tableHira = document.createElement("table");
let head = document.createElement("tr");
head.appendChild(document.createElement("th"));
VOGAIS.forEach(v => {
  const th = document.createElement("th");
  th.textContent = v;
  head.appendChild(th);
});
tableHira.appendChild(head);
for (const cons in HIRAGANA_TABLE) {
  const tr = document.createElement("tr");
  const th = document.createElement("th");
  th.textContent = cons.replace(" (Final)", ""); 
  tr.appendChild(th);
  VOGAIS.forEach(v => {
    const td = document.createElement("td");
    if (HIRAGANA_TABLE[cons][v]) {
      td.innerHTML = `<label><input type="checkbox" value="${HIRAGANA_TABLE[cons][v]}"> ${HIRAGANA_TABLE[cons][v]}</label>`;
    }
    tr.appendChild(td);
  });
  tableHira.appendChild(tr);
}
contHira.appendChild(tableHira);

// Render Katakana Table
const contKata = document.getElementById("table-kata");
const tableKata = document.createElement("table");
let head2 = document.createElement("tr");
head2.appendChild(document.createElement("th"));
VOGAIS.forEach(v => {
  const th = document.createElement("th");
  th.textContent = v;
  head2.appendChild(th);
});
tableKata.appendChild(head2);
for (const cons in KATAKANA_TABLE) {
  const tr = document.createElement("tr");
  const th = document.createElement("th");
  th.textContent = cons.replace(" (Final)", "");
  tr.appendChild(th);
  VOGAIS.forEach(v => {
    const td = document.createElement("td");
    if (KATAKANA_TABLE[cons][v]) {
      td.innerHTML = `<label><input type="checkbox" value="${KATAKANA_TABLE[cons][v]}"> ${KATAKANA_TABLE[cons][v]}</label>`;
    }
    tr.appendChild(td);
  });
  tableKata.appendChild(tr);
}
contKata.appendChild(tableKata);


// ----------------- L√≥gica Hiragana -----------------
let hiraSel = [];
let hiraIdx = 0;

document.getElementById("start-hira").onclick = () => {
  hiraSel = [...document.querySelectorAll("#table-container input:checked")].map(x => x.value);
  if (hiraSel.length === 0) { alert("Selecione pelo menos 1 hiragana!"); return; }
  
  hiraSel = shuffle(hiraSel);
  hiraIdx = 0;
  
  // Reseta estat√≠sticas e esconde tabelas
  resetStats();
  document.getElementById("table-container").style.display = "none";
  document.querySelector(".selection-controls").style.display = "none";
  document.getElementById("start-hira").style.display = "none";
  document.querySelector("#hiragana h2").textContent = "Treino Hiragana";

  document.getElementById("app-hira").style.display = "block";
  showHira();
};

function showHira() {
  document.getElementById("feedback-hira").textContent = "";
  document.getElementById("answer-hira").value = "";
  document.getElementById("kana-hira").textContent = hiraSel[hiraIdx];
  document.getElementById("answer-hira").focus(); 
}

document.getElementById("answer-hira").addEventListener("keyup", e => {
  if (e.key !== "Enter") return;
  const cur = hiraSel[hiraIdx];
  const ok = ROMAJI_MAP[cur];
  
  if (e.target.value.trim().toLowerCase() === ok) {
    document.getElementById("feedback-hira").textContent = "‚úîÔ∏è Correto!";
    document.getElementById("feedback-hira").style.color = "green";
    hiraIdx++;
    if (hiraIdx >= hiraSel.length) {
      document.getElementById("feedback-hira").textContent = "üéâ Fim!";
      document.getElementById("kana-hira").textContent = "";
      return;
    }
    setTimeout(showHira, 600);
  } else {
    document.getElementById("feedback-hira").textContent = "‚ùå Errado!";
    document.getElementById("feedback-hira").style.color = "red";
    
    // --- REGISTRA ERRO ---
    registerError(cur);
    // Limpa o input pra tentar de novo
    e.target.value = ""; 
  }
});


// ----------------- L√≥gica Katakana -----------------
let kataSel = [];
let kataIdx = 0;

document.getElementById("start-kata").onclick = () => {
  kataSel = [...document.querySelectorAll("#table-kata input:checked")].map(x => x.value);
  if (kataSel.length === 0) { alert("Selecione pelo menos 1 katakana!"); return; }
  
  kataSel = shuffle(kataSel);
  kataIdx = 0;

  // Reseta estat√≠sticas e UI
  resetStats();
  document.getElementById("table-kata").style.display = "none";
  document.querySelector("#katakana .selection-controls").style.display = "none";
  document.getElementById("start-kata").style.display = "none";
  document.querySelector("#katakana h2").textContent = "Treino Katakana";

  document.getElementById("app-kata").style.display = "block";
  showKata();
};

function showKata() {
  document.getElementById("feedback-kata").textContent = "";
  document.getElementById("answer-kata").value = "";
  document.getElementById("kana-kata").textContent = kataSel[kataIdx];
  document.getElementById("answer-kata").focus();
}

document.getElementById("answer-kata").addEventListener("keyup", e => {
  if (e.key !== "Enter") return;
  const cur = kataSel[kataIdx];
  const ok = ROMAJI_MAP[cur];

  if (e.target.value.trim().toLowerCase() === ok) {
    document.getElementById("feedback-kata").textContent = "‚úîÔ∏è Correto!";
    document.getElementById("feedback-kata").style.color = "green";
    kataIdx++;
    if (kataIdx >= kataSel.length) {
      document.getElementById("feedback-kata").textContent = "üéâ Fim!";
      document.getElementById("kana-kata").textContent = "";
      return;
    }
    setTimeout(showKata, 600);
  } else {
    document.getElementById("feedback-kata").textContent = "‚ùå Errado!";
    document.getElementById("feedback-kata").style.color = "red";
    // --- REGISTRA ERRO ---
    registerError(cur);
    e.target.value = "";
  }
});


// ------------------ TREINO DE N√öMEROS --------------------

const NUMS = [
  { jp: "‰∏Ä (1)", romaji: "ichi" }, { jp: "‰∫å (2)", romaji: "ni" },
  { jp: "‰∏â (3)", romaji: "san" },  { jp: "Âõõ (4)", romaji: "yon" },
  { jp: "‰∫î (5)", romaji: "go" },   { jp: "ÂÖ≠ (6)", romaji: "roku" },
  { jp: "‰∏É (7)", romaji: "nana" }, { jp: "ÂÖ´ (8)", romaji: "hachi" },
  { jp: "‰πù (9)", romaji: "kyuu" }, { jp: "ÂçÅ (10)", romaji: "juu" }
];

let numsList = [];
let numIndex = 0;

document.getElementById("start-num").onclick = () => {
  numsList = shuffle([...NUMS]);
  numIndex = 0;
  
  resetStats();
  document.getElementById("start-num").style.display = "none";
  
  document.getElementById("app-num").style.display = "block";
  showNum();
};

function showNum() {
  document.getElementById("feedback-num").textContent = "";
  document.getElementById("answer-num").value = "";
  document.getElementById("kana-num").textContent = numsList[numIndex].jp;
  document.getElementById("answer-num").focus();
}

document.getElementById("answer-num").addEventListener("keyup", (e) => {
  if (e.key !== "Enter") return;
  const current = numsList[numIndex];
  if (e.target.value.trim().toLowerCase() === current.romaji) {
    document.getElementById("feedback-num").textContent = "‚úîÔ∏è Correto!";
    document.getElementById("feedback-num").style.color = "green";
    numIndex++;
    if (numIndex >= numsList.length) {
      document.getElementById("feedback-num").textContent = "üéâ Fim!";
      document.getElementById("kana-num").textContent = "";
      return;
    }
    setTimeout(showNum, 600);
  } else {
    document.getElementById("feedback-num").textContent = "‚ùå Errado!";
    document.getElementById("feedback-num").style.color = "red";
    // --- REGISTRA ERRO ---
    // Para n√∫meros, vamos registrar o kanji
    registerError(current.jp);
    e.target.value = "";
  }
});
</script>

</body>
</html>